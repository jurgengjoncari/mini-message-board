<!--<div class="top-bar">-->
<!--  <h3 class="title">Mini Message Board</h3>-->
<!--  <div class="auth-actions">-->
<!--    @if (!isLoggedIn) {-->
<!--      <button (click)="showLogin()">Login</button>-->
<!--      <button (click)="showSignup()" class="signup">Sign Up</button>-->
<!--    } @else {-->
<!--      <button (click)="logout()" class="logout">Logout</button>-->
<!--    }-->
<!--  </div>-->
<!--</div>-->
<div class="chat-container surface">
  <div class="messages" #messagesContainer>
    @if (loading) {
      @for (i of [1, 2, 3, 4, 5]; track i) {
        <div class="chat-message loading"></div>
      }
    } @else {
      @for (group of messages | groupByDate; track group.key) {
        <div class="date-separator">{{ group.key }}</div>
        @for (msg of group.value; track msg._id) {
          <div [class]="'chat-message' + (msg.senderId?._id === currentUser?._id ? ' sent' : ' received')">
<!--            <div class="avatar">-->
<!--              <img [src]="msg.senderId?.profilePicture || '/default-avatar.jpg'"-->
<!--                   [alt]="msg.senderId && getAuthor(msg.senderId) || 'User'"-->
<!--                   (error)="onImgError($event)"/>-->
<!--            </div>-->
            <div class="message-content">
              <div class="chat-author">
                {{ msg.senderId && getAuthor(msg.senderId) || '[deleted user]' }}
              </div>
              <div class="chat-content surface">{{ msg.content }}</div>
              <div class="chat-time">{{ msg.createdAt | date:'HH:mm' }}</div>
            </div>
          </div>
        }
      }
    }
  </div>
  <div class="form-container surface">
    <form>
      @if (isLoggedIn) {
        <button
          type="button"
          (click)="logout()"
          class="logout-button icon surface"
          title="Logout">
<!--          <img class="user-avatar"-->
<!--               [src]="currentUser?.profilePicture || '/default-avatar.jpg'"-->
<!--               alt="Profile picture"/>-->
          <svg
            class="power"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round">

            <!-- The incomplete circle (arc) -->
            <path d="M18.36 6.64a9 9 0 1 1-12.73 0"/>

            <!-- The vertical line -->
            <line x1="12" y1="2" x2="12" y2="12"/>
          </svg>
        </button>
      } @else {
        <button
          type="button"
          (click)="authVisible = true"
          [disabled]="loading"
          class="login-button icon primary"
          title="Login">
          <svg
            class="login-icon"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1"
            stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
            <polyline points="10 17 15 12 10 7"/>
            <line x1="15" y1="12" x2="3" y2="12"/>
          </svg>
        </button>
      }
      <input
        #messageInput
        type="text"
        [(ngModel)]="newMessage"
        name="message"
        (keyup.enter)="sendMessage()"
        [placeholder]="isLoggedIn ? 'Type your message here...' : 'Log in to send messages'"
        class="chat-input"
        required
        [disabled]="loading || !isLoggedIn"
        autocomplete="off"
      />
      <button
        type="button"
        class="send-button icon primary"
        (click)="sendMessage()"
        [disabled]="!isLoggedIn || loading || !newMessage.trim()"
        title="Send"
      >
        <svg
          class="arrow-up"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="12" y1="19" x2="12" y2="5"></line>
          <polyline points="5 12 12 5 19 12"></polyline>
        </svg>
      </button>
    </form>
    <footer class="footer">
      <a href="https://github.com/jurgengjoncari/mini-message-board"
         target="_blank"
         rel="noopener"
         class="github-link">
        <svg class="github-icon" viewBox="0 0 16 16">
          <path fill="currentColor"
                d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
        Source code
        <svg class="new-tab" viewBox="0 0 24 24">
          <path
            fill="currentColor"
            stroke="currentColor"
            stroke-width="1.5"
            d="M6 18L18 6M18 6H9M18 6V15"/>
        </svg>
      </a>
    </footer>
  </div>
</div>
<app-auth
  [(visible)]="authVisible"
  (loginSuccess)="onLoginSuccess()"
>
</app-auth>
